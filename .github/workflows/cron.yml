name: Blog Post Cron

on:
  schedule:
    # 15분마다 실행 (한국 시간 기준이 아니라 UTC 기준이지만 간격은 동일)
    - cron: '*/15 * * * *'
  workflow_dispatch: # 수동 실행 버튼

jobs:
  trigger-cron:
    runs-on: ubuntu-latest
    steps:
      - name: Call Vercel Cron API
        run: |
          URL="${{ secrets.VERCEL_APP_URL }}"
          if [ -z "$URL" ]; then
            echo "::error::VERCEL_APP_URL secret is MISSING! Please add it to Settings > Secrets and variables > Actions > Repository secrets."
            exit 1
          fi
          echo "Triggering Blog Post Generation to: $URL"
          # CRON_SECRET을 헤더에 담아 호출
          curl -X GET "$URL/api/cron" \
          -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
          --fail || exit 1
